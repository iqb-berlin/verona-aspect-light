<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Player</title>
  <meta name="application-name" content="iqb-player-aspect"
        data-version="0.1.0"
        data-repository-url="https://github.com/iqb-berlin/verona-modules-apect"
        data-api-version="3.0.0"
        data-not-supported-api-features=""
        data-supported-unit-definition-types="iqb-aspect-module@0.0.1"
        data-supported-unit-state-data-types="iqb-aspect-player@0.0.1"
        data-supported-browsers='{"Firefox": 69, "Chrome": 72, "Edge": 79}'
  />
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
<player-aspect></player-aspect>
<div style="position: absolute; bottom: 20px; right: 20px; z-index: 100">
  <form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">
    <fieldset>
      <h4>Load Unit Definition</h4>
      <input type='file' id='fileInput' accept='.json,application/json'>
      <input type='button' value='Load separate' onclick='loadUnitDefinition("separate");'>
      <input type='button' value='Load snap' onclick='loadUnitDefinition("concat-scroll-snap");'>
      <input type='button' value='Load scroll' onclick='loadUnitDefinition("concat-scroll");'>
    </fieldset>
  </form>
  <button onclick='denyNavigation();'>Deny Navigation</button>
  <button onclick='toPage(0);'>1</button>
  <button onclick='toPage(1);'>2</button>
  <button onclick='toPage(2);'>3</button>
  <button onclick='toPage(3);'>4</button>
  <select name="stateReportPolicy" id="stateReportPolicy">
    <option value="none">none</option>
    <option value="eager">eager</option>
    <option value="on-demmand">on-demmand</option>
  </select>
</div>
</body>

<script type="text/javascript">
  denyNavigation = () => {
    window.postMessage({
      type: 'vopNavigationDeniedNotification',
      sessionId: 'dev',
      reason: ['presentationIncomplete', 'responsesIncomplete']
    }, '*');
  }

  toPage = (page) => {
    window.postMessage({
      type: 'vopPageNavigationCommand',
      sessionId: 'dev',
      target: page
    }, '*');
  }

  loadUnitDefinition = (pagingMode) => {
    const setStartData = (e) => {
      window.postMessage({
        type: 'vopStartCommand',
        sessionId: 'dev',
        unitDefinition: e.target.result,
        unitState: {
          dataParts: {}
        },
        playerConfig: {
          stateReportPolicy: document.getElementById('stateReportPolicy').value,
          pagingMode: pagingMode, //concat-scroll, separate, concat-scroll-snap
          logPolicy: 'rich',
          startPage: '0',
          enabledNavigationTargets: ['next']
        }
      }, '*');
    }
    const input = document.getElementById('fileInput');
    if (!input['files'][0]) {
      alert("Please choose a file before clicking 'Load'");
    } else {
      const fileReader = new FileReader();
      fileReader.onload = setStartData;
      fileReader.readAsText(input['files'][0]);
    }
  }
</script>
</html>
